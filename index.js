//-------------------------------------Array datos de entidades-----------------------------------

let associationData = [
    {
        id: 44044,
        name: `PADRES Y MADRES DE ALUMNOS EL CASTELLON DEL C.P. RURAL FILABRES`,
        goal: `A) ASISTIR A LOS PADRES O TUTORES EN TODO AQUELLO QUE CONCIERNE A LA EDUCACION DE SUS HIJOS O REPRESENTADOS. B) COLABORAR EN LAS ACTIVIDADES EDUCATIVAS DE LOS CENTROS, Y EN LAS ACTIVIDADES COMPLEMENTARIAS Y EXTRAESCOLARES DE LOS MISMOS. - C) PROMOVER LA PARTICIPACION DE LOS PADRES DE LOS ALUMNOS EN LA GESTION DEL CENTRO. D) FACILITAR LA REPRESENTACION Y PARTICIPACION DE LOS PADRES DE ALUMNOS EN LOS CONSEJOS ESCOLARES DE LOS CENTROS PUBLICOS Y CONCERTADOS, PARA LO CUAL PODRAN PRESENTAR... - CANDIDATURAS EN LOS CORRESPONDIENTES PROCESOS ELECTORALES. E) PROMOVER EL DESARROLLO DE PROGRAMAS DE EDUCACION FAMILIAR. F) REPRESENTAR A LOS PADRES ASOCIADOS A LAS MISMAS ANTE LAS INSTITUCIONES EDUCATIVAS Y OTROS ORGANISMOS. - G) REPRESENTAR A LOS PADRES ASOCIADOS ANTE LAS INSTANCIAS EDUCATIVAS Y OTROS ORGANISMOS, ADEMAS DE PARTICIPAR EN LOS ORGANOS DEL CENTRO, MUNICIPIO, PROVINCIA, COMUNIDAD AUTONOMA, O ADMINISTRACION CENTRAL DEL ESTADO EN LOS QUE SE HAYA ESTABLECIDO O SE ... - REQUIERA LA PRESENCIA DE LA ASOCIACION. H) ORIENTAR Y ESTIMULAR A LOS PADRES RESPECTO DE LAS OBLIGACIONES QUE LES INCUMBEN EN RELACION CON LA EDUCACION DE SUS HIJOS. I) COLABORAR EN LA MEDIDA QUE ASI LE SEA SOLICITADO, EN LA ELABORACION DESARROLLO O ... - MODIFICAICON DEL REGALMENTO DE ORGANIZACION Y FUNCIONAMIENTO DEL CENTRO. J) FOMENTAR LAS RELACIONES DE COOPERACION DEL CENTRO CON OTROS ESTABLECIMIENTOS ESCOLARES Y CON LOS SECTORES SOCIALES Y CULTURALES DEL ENTORNO. J) PROMOVER LA PLENA REALIZACION DEL.. - PRINCIPIO DE GRATUIDAD EN EL AMBITO DEL CENTRO, COMO LA EFECTIVA IGUALDAD DE DERECHOS DE TODOS LOS ALUMNOS, ASI DISCRIMINACION POR RAZONES DE SEXO, DE CONFORMIDAD CON O DISPUESTO POR EL ART. 27.3 CE Y POR LOS ART. 18.1 Y 20.1 LODE. K) OTROS...`,
        registration_date: 2000,
        creation_date: 1999,
        address: `PLAZA DE ESPAÑA, 1`,
        zip_code: 4857,
        province_code: 4,
        province: `ALMERIA`,
        township: `Albánchez`,
        township_code: 46
    },
    {
        id: 40140,
        name: `SOCIOCULTURAL DE INMIGRANTES PALOMA DEL SUR`,
        goal: `DEFENDER LOS INTERESES MATERIALES Y MORALES DE LOS INMIGRANTES.- TRABAJAR POR LA INTEGRACION DEL INMIGRANTE EN LA SOCIEDAD DE ACOGIDA.- PROMOVER LA RECUPERACION HUMANA COMO PREVIO PLANTEAMIENTO A LA INTEGRACION.- INTERCAMBIO DE LAS DIFERENTES CULTURAS CON LA CULTURA ESPAÑOLA, ANDALUZA.- OFRECER SERVICIOS DE INFORMACION, ORIENTACION Y PROMOCION.- ORGANIZAR, PROMOVER Y PARTICIPAR EN ACTIVIDADES ORMATIVAS, CULTURALES Y DE OCIO.- COLABORAR CON OTROS COLECTIVOS QUE TENGAN LOS MISMOS FINES QUE LA ASOCIACION SOCIOCULTURAL DE EMIGRANTES PALOMA DEL SUR.- FAVORECER LA CONCIENCIA DE LA PROPIA DIGNIDAD Y AUTOESTIMA.- COLABORAR CON DIFERENTES PLATAFORMAS SOCIALES LOCALES, MUNICIPALES Y PROVINCIALES PARA LA CONSECUCION DE LOS FINES QUE SE EXPRESAN EN LOS ESTATUTOS.- CONSOLIDARSE COMO GRUPO REFERENTE DE PARTICIPACION Y PERTENENCIA, DE CARA A GENERAR MAYOR COHERENCIA Y PROTAGONISMO ENTRE EL COLECTIVO INMIGRANTE.- ORGANIZAR ACTIVIDADES DE ENCUENTRO Y CONVIVENCIA INTERCULTURAL CON OTROS INMIGRANTES Y CON LA SOCIEDAD DE ACOGIDA.`,
        registration_date: 2000,
        creation_date: 1999,
        address: `C/ PIO BAROJA, 44`,
        zip_code: 4700,
        province_code: 4,
        province: `ALMERIA`,
        township: `Ejido (El)`,
        township_code: 9026
    },
    {
        id: 57849,
        name: `PADRES Y MADRES DEL ALUMNADO SOL DE PONIENTE DEL COLEGIO PUBLICO CEIP PONIENTE DEL SOLANILLO`,
        goal: `ASISITIR A LOS PADRES, MADRES O TUTORES EN TODO AQUELLO QUE CONCIERNE A LA EDUCACIÓN DE SUS HIJOS O REPRESENTADOS. - COLABORAR EN LAS ACTIVIDADES EDUCATIVAS DEL CENTRO, Y EN LAS ACTIVIDADES COMPLEMENTARIAS Y EXTRAESCOLARES DE LOS MISMOS. - PROMOVER LA PARTICIPACIÓN DE LOS PADRES, MADRES DEL ALUMNADO EN LA GESTIÓN DEL CENTRO. - FACILITAR LA REPRESENTACIÓN Y PARTICIPACIÓN DE LOS PADRES Y MADRES DEL ALUMNADO EN EL CONSEJO ESCOLAR DEL CENTRO, PARA LO CUAL PODRÁN PRESENTAR CANDIDATURAS EN LOS CORRESPONDIENTES PROCESOS ELECTORALES. - PROMOVER EL DESARROLLO DE PROGRAMAS DE EDUCACION FAMILIAR. - REPRESENTAR A LOS PADRES Y MADRES ASOCIADOS ANTE LAS INSTANCIAS EDUCATIVAS Y OTROS ORGANISMOS, ADEMÁS DE PARTICIPAR EN LOS ÓRGANOS DEL CENTRO, MUNICIPIO, PROVINCIA, COMUNIDAD AUTÓNOMA O ADMINISTRACIÓN CENTRAL DE ESTADO EN LOS QUE SE HAYA ESTABLECIDO O ... - ...REQUIERA LA PRESENCIA DE LA ASOCIACION. OTROS.`,
        registration_date: 2000,
        creation_date: 1999,
        address: `PLAZA BARCELONA, 5 -EL SOLANILLO-`,
        zip_code: 4740,
        province_code: 4,
        province: `ALMERIA`,
        township: `Roquetas de Mar`,
        township_code: 792
    },
    {
        id: 41743,
        name: `MINUSVALIDOS DE CUEVAS DEL ALMANZORA A.M.C.A.L.`,
        goal: `DEFENDER LA DIGNIDAD Y LOS DERECHOS DE LAS PERSONAS CON DISCAPACIDAD - PROMOVER LA INTEGRACION ESCOLAR, LABORAL Y SOCIAL DE LAS PERSONAS MINUSVÁLIDAS - PROMOVER ACTITUDES POSITIVAS HACIA LAS PERSONAS MINUSVALIDAS - PROMOVER LA LEGISLACION ADECUADA QUE MEJORE LA SITUACION DEL COLECTIVO DE PERSONAS CON DISCAPACIDAD - SER CAUCE DE COLABORACION ENTRE ORGANISMOS PUBLICOS Y PRIVADOS. - ELEVAR PROPUESTAS SUGERENCIAS Y CONSULTAS A LOS ORGANISMOS RELACIONADOS CON LA PROBLEMATICA SOCIAL DE ESTE COLECTIVO A NIVEL LOCA, REGIONAL O NACIONAL, SIEMPRE QUE SE ESTIME CONVENIENTE. - CUALQUIER OTRO QUE DE MODO DIRECTO O INDIRECTO, PUEDA CONTRIBUIR ALK CUMPLIMIENTO DE LA MISIÓN DE LA ASOCIACION O REDUNDAR EN BENEFICIO DE LAS PERSONAS CON DISCAPACIDAD.`,
        registration_date: 2000,
        creation_date: 1999,
        address: `CALLE LAS LISAS, 21`,
        zip_code: 4610,
        province_code: 4,
        province: `ALMERIA`,
        township: `Cuevas del Almanzora`,
        township_code: 353
    },
    {
        id: 40142,
        name: `VIVALDI`,
        goal: `A) atender a las necesidades deportivas de los vecinos del municipio. - B) promocionar la cultura y el deporte en todas sus extensiones y manifestaciones a traves de la realizacion de talleres de musica, baile y actividades deportivas como escuelas de deporte. (futbol, voleibol, atletismo, ajedrez). - C) recuperacion de tradiciones y costumbres. - D) crear distintas secciones: juventud, mujer o otro tipo que se estime conveniente. - - -`,
        registration_date: 2000,
        creation_date: 1999,
        address: `AVDA. ANDALUCIA Nº 1`,
        zip_code: 4692,
        province_code: 4,
        province: `ALMERIA`,
        township: `Taberno`,
        township_code: 890
    },
    {
        id: 58240,
        name: `ALUMNAS Y ALUMNOS DE EDUCACIÓN PERMANENTE BOLLULLOS DEL C.E.P. LA PIÑA", 
        goal: "Colaborar con la comunidad educativa del Centro de Educación Permanete en la educación y en la formación para lograr una formación integral y una educación para la igualdad.La defensa de los derechos del alumnado, en el sentido de que reciban de una forma - eficiente la debida enseñanza del centro de educación permanente " La Piña".Estimular la creación y desarrollo de instituciones, servicios y actividades del Centro de Educación Permanente "La Piña", culturales, pedagógicas, éticas, educación en valores, - educación para la paz y la no violencia, educación en igualdad de oportunidades entre mujeres y hombres y en definitiva a la formación integral del alumnado.Ayudar al Centro de Educación Permanente....... - - - -`,
        registration_date: 2007,
        creation_date: 2007,
        address: `c/ Medina Sidonia, nº 35`,
        zip_code: 21710,
        province_code: 21,
        province: `HUELVA`,
        township: `Bollullos Par del Condado`,
        township_code: 139
    },
    {
        id: 19653,
        name: `PEÑA CULTURAL FLAMENCA DE ARJONA`,
        goal: `a) Estudio, conservación promoción y divulgación del Arte Flamenco en cualquiera de sus formas de expresión, cante, toque y baile, procurando su introducción en los Centros escolares, como elemento cultural y actividad propia del pueblo andaluz. b) Velar por la pureza del Flamenco y luchar contra su adulteración o manipulación en cualquier tipo. c) La promoción de nuevos interpretes del flamenco, naturales o residentes en esta localidad, con recopilación, de ser posible de los antes autóctonos conocidos. d) Promocionar a sus miembros medios materiales, (discografía, bibliografía, conferencias, recitales, tertulias, etc.) que les permitan profundizar en el conocimiento de este arte y les sirva para su recreo. c) Ofrecer a sus miembros y familiares, en todo momento un ambiente de grata y cordial convivencia.`,
        registration_date: 1985,
        creation_date: 1985,
        address: `SAN NICASIO, 4, BAJO A`,
        zip_code: 23760,
        province_code: 23,
        province: `JAEN`,
        township: `Arjona`,
        township_code: 63
    },
    {
        id: 12392,
        name: `JOVEN ORQUESTA PROVINCIAL DE MÁLAGA`,
        goal: `1º.- El sostenimiento y promoción de su orquesta.- 2º.- Fomentr la afición a la música en la sociedad, difundiendo desde la Orquestal a la de Cámara en la Provncia de Málaga en particular, y en toda Andalucía, en general, con especial atención a los niños y jóvenes.Prestando interés en el ocio y la Educación Inclusiva, así como en la Diversidad Educativa. Desdenuestra Asocición y siempre que haya demanda colaboraremos por integrar en nuestras orquesta personas en necesidades educativas diversas. Dado que la juventud y la educación es nuestra herramienta de trabajo, colaboraremos en los aspectos anteriores.- 3º.- Completar la formación de los niños y jóvenes estudiantes de música, ofreciéndoles una formación musical integral que les permita iniciarse, prepararse o especializarse en la práctica colectiva de la música.- 4º.- La Asociación Joven Orquesta Provincial de Málaga asume como principios fundamentales en su régimen de orden interno y funcionamiento, la igualdad de género entre sus asociados, así como la paridad en sus órganos de gestión y dirección. La Junta Directiva habrá de estar integrada en una proporción de 50% entre asociados y asociadas o viceversa.- 5º.- Así mismo adopta un compromiso claro con el Medio Ambiente, la Ecología y la sostenibilidad. Favoreciendo el reciclaje y el consumo responsable. Las comunicaciones a y entre los componenetes de la Asociación, a partir de ahora pasan a ser vía electrónica. El Transporte de la orquesta a los espacios escénicos donde desarrolle sus actividades, se hará en transporte colectivo.- 6º.- Nuestra asociación, apuesta por las nuevas tecnologías y la innovación, para ello apuesta por el trabajo en red, sindo las comunicaciones, notificaciones, envío de material, certificaciones, audiovisuales y cualquier otra actividad que surja, entre los componentes de la asociación y su entorno, se hará vía telemática y a través de las Redes Sociales.- 7º.- Apostamos por el entendimiento intercultural y la colaboración transfronteriza. Constituye una vocación y objetivo fundamental de nuestra asociación, así como la formación y la integración de la diversidad en nustro común proyecto. Nuestra colaboración transcultural y transfronteriza se basa en los intercambios que cada año las y los jóvenes componentes de la orquesta participan en festivales de orquestas de jóvenes interactuando con las mas variopintas nacionalidades.- 8º.- Resolución de conflictos, mediacion. Para la solución de los conflictos o divergencias que pudieren generarse en el devenir de nuestra asociación las y los componentes de nuestra asociación, se someten de manera expresa a la mediación y arbitraje de la Comisión de asociados que se creará al efecto, y que estará integrada por tres miembros de la asociación elegidos en Asamblesa General con facultades decisorias.- 9º (incluido según acuerdo de la A.G. de 2 La labor de nuestra asociación se está haciendo muy amplia y pensamos que debemos colaborar de forma activa en el tejido de........`,
        registration_date: 1994,
        creation_date: 1994,
        address: `C/ Sèptimo Miau, nº 3, Locales 1 y 2`,
        zip_code: 29006,
        province_code: 29,
        province: `MALAGA`,
        township: `Málaga`,
        township_code: 672
    },
    {
        id: 44925,
        name: `CASA DE LA PAZ`,
        goal: `2.1-CREAR EN SEVILLA UN ESPACIO "CASA DE LA PAZ"QUE SERÁ SEDE DE LOS TRES GRUPOS PROMOTORES,SIEMPRE QUE ESTOS PERTENEZCAN A LA FEDERACION,DONDE REALIZAR LAS ACTIVIDADES PROPIAS DE ESTOS GRUPOS Y LOS DE LA FEDERACION.2.2-SERVIR DE UNION,COORDINACION,INTERC - AMBIO Y ORIENTACION ENTRE LAS ASOCIACIONES FEDERADAS,PARA EL MEJOR DESARROLLO DE SUS FINES COMUNES. - SE ADJUNTA FOTOCOPIA DE FINES. - - - -`,
        registration_date: 1979,
        creation_date: 1979,
        address: `C/ ANICETO SAENZ,Nº 1, LOCAL 3`,
        zip_code: 41003,
        province_code: 41,
        province: `SEVILLA`,
        township: `Sevilla`,
        township_code: 917
    },
    {
        id: 46163,
        name: `EMPRESARIAL DE ARTESANOS CASTALLA`,
        goal: `A) REPRESENTAR A SUS ASOCIADOS EN LA DEFENSA DE SUS INTERESES LABORALES, PROFESIONALES Y ECONOMICOS. B) PROMOCIÓN, CONTROL Y DEFENSA DE LA ACTIVIDAD PROFESIONAL EN EL SECTOR.`,
        registration_date: 2000,
        creation_date: 2000,
        address: `C/ Príncipe de Asturias, nº 42 "Hacienda Santa Bárbara"`,
        zip_code: 41950,
        province_code: 41,
        province: `SEVILLA`,
        township: `Castilleja de la Cuesta`,
        township_code: 299
    }
]

// --------------------------------- Array lineas telefonicas ------------------------------

var phoneArray = [{
    year: 2021,
    province: "Almeria",
    landline: 222492,
    post_payment_phone_line: 600789,
    wide_landline: 212484,
},
{
    year: 2021,
    province: "Cadiz",
    landline: 423226,
    post_payment_phone_line: 1089523,
    wide_landline: 391532,
},
{
    year: 2020,
    province: "Almeria",
    landline: 233958,
    post_payment_phone_line: 569175,
    wide_landline: 197537,
},
{
    year: 2020,
    province: "Cadiz",
    landline: 435857,
    post_payment_phone_line: 1069142,
    wide_landline: 382361,
},
{
    year: 2019,
    province: "Almeria",
    landline: 220754,
    post_payment_phone_line: 552149,
    wide_landline: 184055,
},
{
    year: 2019,
    province: "Cadiz",
    landline: 427619,
    post_payment_phone_line: 1036807,
    wide_landline: 364029,
},
{
    year: 2018,
    province: "Almeria",
    landline: 221809,
    post_payment_phone_line: 520852,
    wide_landline: 178567,
},
{
    year: 2018,
    province: "Cadiz",
    landline: 430298,
    post_payment_phone_line: 930651,
    wide_landline: 352690,
},
{
    year: 2017,
    province: "Almeria",
    landline: 227071,
    post_payment_phone_line: 510534,
    wide_landline: 171232,
},
{
    year: 2017,
    province: "Cadiz",
    landline: 440327,
    post_payment_phone_line: 956742,
    wide_landline: 349104,
}
];

// ------------------------------Array datos con los tipos de familiares-------------------------------

var projectionHomes = [

    { province: "Almería", year: 2002, couple_children: 894148, couple_nochildren: 341796, single_parent: 150083 },
    { province: "Almería", year: 2003, couple_children: 886009, couple_nochildren: 409021, single_parent: 150465 },
    { province: "Almería", year: 2004, couple_children: 931404, couple_nochildren: 470139, single_parent: 164749 },
    { province: "Almería", year: 2005, couple_children: 859291, couple_nochildren: 452127, single_parent: 161659 },
    { province: "Almería", year: 2006, couple_children: 909246, couple_nochildren: 456352, single_parent: 201520 },
    { province: "Almería", year: 2007, couple_children: 948195, couple_nochildren: 515896, single_parent: 195633 },
    { province: "Almería", year: 2008, couple_children: 1068369, couple_nochildren: 575006, single_parent: 171857 },
    { province: "Almería", year: 2009, couple_children: 1041268, couple_nochildren: 558298, single_parent: 208899 },
    { province: "Almería", year: 2010, couple_children: 987317, couple_nochildren: 585697, single_parent: 221869 },

    { province: "Huelva", year: 2011, couple_children: 851060, couple_nochildren: 452784, single_parent: 161686 },
    { province: "Huelva", year: 2012, couple_children: 857901, couple_nochildren: 403155, single_parent: 214345 },
    { province: "Huelva", year: 2013, couple_children: 814218, couple_nochildren: 417317, single_parent: 253532 },
    { province: "Huelva", year: 2014, couple_children: 748925, couple_nochildren: 466565, single_parent: 233697 },
    { province: "Huelva", year: 2015, couple_children: 810278, couple_nochildren: 409156, single_parent: 221309 },
    { province: "Huelva", year: 2016, couple_children: 829139, couple_nochildren: 359835, single_parent: 243771 },
    { province: "Huelva", year: 2017, couple_children: 887184, couple_nochildren: 344886, single_parent: 220562 },
    { province: "Huelva", year: 2018, couple_children: 873261, couple_nochildren: 385670, single_parent: 204814 },
    { province: "Huelva", year: 2019, couple_children: 863731, couple_nochildren: 399176, single_parent: 209060 },
    { province: "Huelva", year: 2020, couple_children: 861369, couple_nochildren: 406862, single_parent: 211070 },
    { province: "Huelva", year: 2021, couple_children: 860099, couple_nochildren: 414464, single_parent: 212114 },

];

// funcion media de codigos por provincia

function getTownshipCodeAverage(dataArray) {

    let filteredArray = dataArray.filter(dataRow => dataRow[8] === "ALMERIA");

    let length = filteredArray.length;
    let sum = 0;
    filteredArray.forEach(element => {
        sum += element[10];
    });

    /*
    let sum = filteredArray.reduce((acum, current) => {
        acum + current[10], initial;
    })
    */

    return sum / length;
}

// funcion media lineas telefonicas 

function averageWideLandline(province) {

    s = phoneArray.filter(n => n.province === province);
    size = s.length;
    let total = 0
    s.forEach(element => {
        total = total + element.wide_landline
    });
    console.log(total);
    return total / size

}

// funcion media de parejas con hijos de Huelva entre los anyos 2005 hasta 2015 (ambos incluidos)

function averageCoupleChildren(province) {

    var sum = projectionHomes.filter(anyo => anyo.year >= 2005 && anyo.year <= 2015 && anyo.province === province)
        .map(couple => couple.couple_children)
        .reduce((a, n) => (a += n, a), 0);

    var filters = projectionHomes.filter(anyo => anyo.year >= 2005 && anyo.year <= 2015 && anyo.province === province)
        .map(couple => couple.couple_children)

    var half = sum / filters.length;

    var round = half.toFixed(2);

    return round;

}

// Abrir puertos y caras ascii

var cool = require("cool-ascii-faces");

var express = require("express");

var app = express();

var port = process.env.PORT || 12345;

// cool faces (obtener ruta /cool)

app.get("/cool", (req, res) => {
    res.send(cool());
    console.log("New face request");

});

// Obtener los resultados de las medias por cada ruta

app.get("/samples/IGR", (req, res) => {
    res.send(`` + getTownshipCodeAverage(associationData));
    console.log(`New data request to IGR route`);
});

app.get("/samples/VRJ", (req, res) => {
    res.send(String(averageWideLandline("Almeria")));
});

app.get("/samples/CAC", (req, res) => {
    res.send(averageCoupleChildren("Huelva"));
    console.log(`New data request to CAC route`);
});

const BASE_API_URL_ASSOC = "/api/v1/association-stats";

app.get(BASE_API_URL_ASSOC, (req, res) => {
    if (Object.keys(req.query).length === 0) {
        res.json(associationData);
    }
    else {
        //test
        res.sendStatus(405, "Forbidden");
    }
})

app.get(BASE_API_URL_ASSOC + "/:id", (req, res) => {
    var idParam = parseInt(req.params.id);
    console.log(idParam);
    var data = associationData.filter(x => {
        if(x.id === idParam) {
            return x;
        }     
    });
    if (data.length > 0) {
        res.json(data);
    }
    else {
        //test
        res.sendStatus(404, 'NotFound');
    }

})

// Escuchar puertos abiertos

app.listen(port, () => {
    console.log(`Server ready in port ${port}`);
});

